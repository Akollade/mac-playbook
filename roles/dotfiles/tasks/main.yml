---
- name: Clone oh-my-zsh repo
  git:
    repo: https://github.com/robbyrussell/oh-my-zsh.git
    dest: ~/.oh-my-zsh
    force: yes

- name: Clone custom plugin
  git:
    repo: "{{ item.url }}"
    dest: "~/.oh-my-zsh/custom/plugins/{{ item.name }}"
    force: yes
  with_items: "{{ zsh_custom_plugins }}"

- name: deploy .zshrc
  template:
    src: zshrc.j2
    dest: ~/.zshrc

- name: deploy .zsh_aliases
  template:
    src: zsh_aliases.j2
    dest: ~/.zsh_aliases

- name: ensure user config file exists
  copy:
    content: ""
    dest: ~/.zshrc.local
    force: no

- name: set zsh as default shell
  user:
    name: "{{ lookup('env','USER') }}"
    shell: /bin/zsh
  become: true

- name: Add SSH config
  copy:
    content: "{{ ssh_config }}"
    dest: ~/.ssh/config
  when: ssh_config is defined and ssh_config != ''

- name: deploy .sqliterc
  copy:
    src: sqliterc
    dest: ~/.sqliterc

- name: deploy global editorconfig
  template:
    src: editorconfig.j2
    dest: ~/.editorconfig
